clear all;
clc;

syms the1 the2 the3 the1_dot the2_dot the3_dot the1_2dot the2_2dot the3_2dot;
syms d2 d5;
syms m1 m2 mEE g0 the the_dot;
c2=cos(the2);
s2=sin(the2);
c3=cos(the3);
s3=sin(the3);
c23=cos(the2 + the3);
s23=sin(the2+the3);
the = [the1; the2; the3];
the_dot = [the1_dot; the2_dot; the3_dot];

P_0_EE = [(d5*c23 + d2*c2); (d5*s23 + d2*s2); 0];
P_0_2 = [d2*cos(the2); d2*sin(the2); 0];
P_0_1 = [0; 0; 0];


V_0_EE = [((d5*s23 + d2*s2)*(-the2_dot) - d5*s23*the3_dot);...
          ((d5*c23 + d2*c2)*the2_dot + d5*c23*the3_dot);...
          0];
V_0_2 = [(-d2*s2*the2_dot);...
         (d2*c2*the2_dot);...
         0];
V_0_1 = [0; 0; 0];
 

J_EE = [0 (-(d5*s23 + d2*s2)) (-d5*s23);...
        0 (d5*c23 + d2*c2)    (d5*c23);...
        0 0                   0];
J_EE_T = J_EE';
J_2 = [0 (-d2*s2) 0;...
       0 (d2*c2)  0;...
       0 0        0];
J_2_T = J_2';
J_1 = [0 0 0;...
       0 0 0;...
       0 0 0];
J_1_T = J_1';

M = (m1*(J_1_T)*J_1 + m2*(J_2_T)*J_2 + mEE*(J_EE_T)*J_EE);
M_inv = inv(M);
dJ1_dthe1 = [0 0 0;...
             0 0 0;...
             0 0 0];
dJ1_dthe2 = [0 0 0;...
             0 0 0;...
             0 0 0];
dJ1_dthe3 = [0 0 0;...
             0 0 0;...
             0 0 0];
dJ2_dthe1 = [0 0 0;...
             0 0 0;...
             0 0 0];
dJ2_dthe2 = [0 -d2*c2 0;...
             0 -d2*s2 0;...
             0 0 0];
dJ2_dthe3 = [0 0 0;...
             0 0 0;...
             0 0 0];
dJEE_dthe1 = [0 0 0;...
              0 0 0;...
              0 0 0];
dJEE_dthe2 = [0 (-d5*c23 - d2*c2) -d5*c23;...
              0 (-d5*s23 - d2*s2) -d5*s23;...
              0 0                 0];
dJEE_dthe3 = [0 -d5*c23 -d5*c23;...
              0 -d5*s23 -d5*s23;...
              0 0       0];
         
V1 = (the_dot')*(m1*dJ1_dthe1*J_1 + m2*dJ2_dthe1*J_2 + mEE*dJEE_dthe1*J_EE)*the_dot;
V2 = (the_dot')*(m1*dJ1_dthe2*J_1 + m2*dJ2_dthe2*J_2 + mEE*dJEE_dthe2*J_EE)*the_dot;
V3 = (the_dot')*(m1*dJ1_dthe3*J_1 + m2*dJ2_dthe3*J_2 + mEE*dJEE_dthe3*J_EE)*the_dot;

dP_dthe = (J_2' + J_EE')*g0;
V=[V1; V2; V3]-dP_dthe;
